# ETL CANON (Test Environment)

Документ описывает контракт тестового окружения ETL.
Test допускает упрощения, но не нарушает архитектурные границы SSOT.

---

## 1. Назначение Test

Test предназначен для:

- проверки изменений кода
- отладки парсеров
- воспроизведения инцидентов
- проверки DQ-порогов
- тестирования новых поставщиков

Test не является источником прод-данных.

---

## 2. Изоляция

Test полностью изолирован от Prod.

Структура идентична прод, отличается только ETL_BASE.

Запрещено:

- использовать prod SSOT
- писать в prod директории
- использовать prod конфиг

---

## 3. Git

Работа ведётся в ветке `test`.

Prod работает из `main`.

Merge в `main` только после успешного теста.

---

## 4. Структура каталогов

etl_data/
  raw_v1/
    inbox/
    quarantine/
    archive/
    ssot/

etl_ops/
  runs/
  diag/
  tmp/
  config/

Структура совпадает с prod.

---

## 5. Inbox Model (Test)

Разрешено:

- несколько файлов
- одинаковые имена
- повторные запуски одного и того же файла

Отличия от Prod:

- дедупликация может быть отключена
- повторная обработка входа разрешена
- run_id может быть перезапущен

---

## 6. Gate

Gate выполняет технические проверки.

В Test допускается:

- ослабление порогов
- WARN вместо FAIL
- запуск с пустыми файлами (если разрешено в конфиге)

---

## 7. Data Quality

DQ-пороги могут быть:

- отключены
- ослаблены
- экспериментально изменены

---

## 8. SSOT

SSOT в Test:

- не является прод-источником истины
- может быть очищен
- может быть перегенерирован

Допускается:

- удалять runs
- перезаписывать данные
- сбрасывать дедуп-индексы

---

## 9. Retention

Test может использовать короткий retention.

Допускается полная очистка окружения.

---

## 10. Disk Pressure

Disk Pressure в Test может:

- удалять всё кроме текущего run
- очищать SSOT
- выполнять reset

---

## 11. Принцип

Test — песочница.
Prod — контракт.
