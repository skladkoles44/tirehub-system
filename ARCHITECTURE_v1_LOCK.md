# ARCHITECTURE_v1_LOCK.md
Version: v1.0
Status: LOCKED
Date: 2026-02-11

---

# üß† ETL Architecture v1.0 ‚Äî SSOT Core Locked

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π milestone ingestion-—Å–ª–æ—è.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (v1.1+).

---

# üéØ –¶–µ–ª—å —Å–ª–æ—è

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ XLSX –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π NDJSON
–±–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

–ü—Ä–∏–Ω—Ü–∏–ø: SSOT (Single Source of Truth)

---

# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –º–æ–¥–µ–ª—å

Supplier XLSX
    ‚Üì
Streaming Reader (read_only)
    ‚Üì
Row Iterator
    ‚Üì
Minimal Normalization
    ‚Üì
NDJSON Writer (.tmp ‚Üí atomic rename)
    ‚Üì
Batch Folder
    ‚Üì
SSOT Storage

---

# üì¶ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ù–ï –ù–ê–†–£–®–ê–¢–¨)

1. –û–¥–∏–Ω XLSX-–ª–∏—Å—Ç ‚Üí –æ–¥–∏–Ω NDJSON —Ñ–∞–π–ª
2. –û–¥–∏–Ω –ª–∏—Å—Ç ‚Üí –æ–¥–∏–Ω stats.json
3. Batch-–ø–∞–ø–∫–∞ = –∞—Ç–æ–º–∞—Ä–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –ø—Ä–∏—ë–º–∞
4. –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
5. –¢–æ–ª—å–∫–æ streaming-—á—Ç–µ–Ω–∏–µ
6. Fail-fast –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
7. –ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ .tmp ‚Üí rename

---

# üìñ –ß—Ç–µ–Ω–∏–µ XLSX

- openpyxl load_workbook(read_only=True)
- –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
- –ë–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏—Å—Ç–∞ –≤ –ø–∞–º—è—Ç—å
- –ë–µ–∑ pandas

---

# üìù NDJSON

–§–æ—Ä–º–∞—Ç:
–û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç

–ì–∞—Ä–∞–Ω—Ç–∏–∏:
- UTF-8
- –ë–µ–∑ BOM
- –ë–µ–∑ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

---

# üìä stats.json

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ:

{
  "rows_total": int,
  "rows_emitted": int,
  "rows_skipped": int,
  "errors": int,
  "duration_seconds": float
}

---

# üö´ –ß—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤ ingestion

- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è
- –†–∞—Å—á—ë—Ç –º–∞—Ä–∂–∏
- –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –°–∫–ª–∞–¥—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- –ö—Ä–æ—Å—Å-–ª–∏—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

# ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–û–∂–∏–¥–∞–Ω–∏–µ:
- –î–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á —Å—Ç—Ä–æ–∫: –º–∏–Ω—É—Ç—ã
- –°–æ—Ç–Ω–∏ —Ç—ã—Å—è—á: –¥–µ—Å—è—Ç–∫–∏ –º–∏–Ω—É—Ç
- ~1 —á–∞—Å = —Å–∏–≥–Ω–∞–ª –æ –ø—Ä–æ–±–ª–µ–º–µ

---

# üîí –°—Ç–∞—Ç—É—Å

Architecture v1.0 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞.
–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞.
